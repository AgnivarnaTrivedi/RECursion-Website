<% content_for :heading do %>
	askREC
<% end %>
<div class="container-fluid" style="min-height: 100%;">
  <div class="row">
    <div class="col s12 m10 offset-m1 l3 push-l9">
      <div class="search_wrapper">
        <input id="search" placeholder="Search for Tags">
        <div class="search_results"></div>
      </div>
      <div class="card">
        <div class="container2" style="padding-top: 5px; padding-bottom: 10px">
          <div class="text-center" style="padding-top: 10px;"><h5>Popular Tags</h5><hr></div>
          <p style="word-wrap: break-word; margin: 0px;">
          <% @tags.each do |tag| %>
          <h6><%= tag.name %>
          <span class="new badge" data-badge-caption="" style="float: right; margin-top: 0px;" ><%= tag.questions.count %></span></p>
          </h6>
          <% end %>
        </div>
      </div>
    </div>
    <div class="col s12 m10 offset-m1 l9 pull-l3">
      <table class="highlight" style="width:100%">
        <thead>
          <tr>
          <th>Title</th>
          <th style="text-align: center;"><%= 'Posted by' %></th>
          <th style="text-align: center;"><%= sortable "Answers" %></th>
          <th style="text-align: center;"><%= sortable "Follows" %></th>
          <th style="text-align: center;"><%= sortable "Date", "Posted On" %></th>
          </tr>
        </thead>
      <% @questions.each do |question| %>
        <tr>
          <td ><%= link_to question.title.truncate(75), question_path(question) %></td>
          <td style="text-align: center;"><%= link_to link_to image_tag(User.find(question.user_id).image_url, size: "40x40", class: 'circle'), users_path(User.find(question.user_id).nickname) %></td>
          <td class="center"><% if !question.tags[0].nil? %><span class="new badge" data-badge-caption=""><%= question.tags[0].name %></span><% end %><% if !question.tags[1].nil? %><span class="new badge" data-badge-caption=""><%= question.tags[1].name %></span><% end %></td>
          <td style="text-align: center;"><%= question.answer_count %></td> 
          <td style="text-align: center;"><%= question.follow_count %></td>
          <td style="text-align: center;"><%= question.created_at.strftime('%b %d') %></td>
        </tr>
      <% end %>
      </table>
      <%= will_paginate @questions %>
    </div>
  </div>
</div>



<script>
  
$(document).ready(function(){

    $("#search").keyup(function(){
      keyword = $(this).val();

      if( keyword.length < 1 || /^[\s]*$/.test(keyword) == true){
        $('.search_results').html("");
        return;
      }

      $.ajax({
        type: "POST",
        url: "/find_questions",
        data: {"keyword": keyword},
        success: function(result){
          var newHTML = [];
          for (var i = 0; i < result.tags.length; i++) {
            newHTML.push('<h6><a href="/askrec/questions/tags/' + result.tags[i][0] + '">' + result.tags[i][0] + '</a><span class="new badge" data-badge-caption="">' + result.tags[i][1] + '</span></h6><br />');
          }
          $('.search_results').html(newHTML);
        },
      });
    });

});

</script>
